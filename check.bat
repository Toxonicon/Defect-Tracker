@echo off
chcp 65001 >nul
title Defect Tracker - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

echo.
echo üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã Defect Tracker...
echo ================================================
echo.

:: –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞
cd /d "%~dp0"

set "errors=0"

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º Node.js
echo üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js...
node --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Node.js –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
    set /a errors+=1
) else (
    echo ‚úÖ Node.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: 
    node --version
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º npm
echo.
echo üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ npm...
npm --version >nul 2>&1
if errorlevel 1 (
    echo ‚ùå npm –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
    set /a errors+=1
) else (
    echo ‚úÖ npm —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: 
    npm --version
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
echo.
echo üìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞...
if not exist "frontend" (
    echo ‚ùå –ü–∞–ø–∫–∞ frontend –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!
    set /a errors+=1
) else (
    echo ‚úÖ –ü–∞–ø–∫–∞ frontend –Ω–∞–π–¥–µ–Ω–∞
)

if not exist "backend" (
    echo ‚ùå –ü–∞–ø–∫–∞ backend –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!
    set /a errors+=1
) else (
    echo ‚úÖ –ü–∞–ø–∫–∞ backend –Ω–∞–π–¥–µ–Ω–∞
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ backend
echo.
echo üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Backend...
if not exist "backend\node_modules" (
    echo ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Backend –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
    echo üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ: install.bat
    set /a errors+=1
) else (
    echo ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Backend —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ frontend
echo.
echo üé® –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Frontend...
if not exist "frontend\node_modules" (
    echo ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Frontend –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
    echo üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ: install.bat
    set /a errors+=1
) else (
    echo ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Frontend —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo.
echo ‚öôÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...
if not exist "backend\package.json" (
    echo ‚ùå backend\package.json –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a errors+=1
) else (
    echo ‚úÖ backend\package.json –Ω–∞–π–¥–µ–Ω
)

if not exist "frontend\package.json" (
    echo ‚ùå frontend\package.json –Ω–µ –Ω–∞–π–¥–µ–Ω!
    set /a errors+=1
) else (
    echo ‚úÖ frontend\package.json –Ω–∞–π–¥–µ–Ω
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤
echo.
echo üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤...
netstat -an | find "3000" | find "LISTENING" >nul
if not errorlevel 1 (
    echo ‚ö†Ô∏è –ü–æ—Ä—Ç 3000 —É–∂–µ –∑–∞–Ω—è—Ç! (Backend)
    echo üí° –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç
)

netstat -an | find "5173" | find "LISTENING" >nul
if not errorlevel 1 (
    echo ‚ö†Ô∏è –ü–æ—Ä—Ç 5173 —É–∂–µ –∑–∞–Ω—è—Ç! (Frontend)
    echo üí° –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç
)

:: –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo.
echo ================================================
if %errors% equ 0 (
    echo üéâ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É!
    echo üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∫–æ–º–∞–Ω–¥–æ–π: start.bat
) else (
    echo ‚ùå –ù–∞–π–¥–µ–Ω–æ –æ—à–∏–±–æ–∫: %errors%
    echo üí° –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
)
echo ================================================
echo.
pause